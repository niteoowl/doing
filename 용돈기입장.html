<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš©ëˆ ê¸°ì…ì¥</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Notion Global Styles */
        :root {
            --text-color: #37352f;
            --subtle-text-color: #787774;
            --border-color: rgba(55, 53, 47, 0.09);
            --background-color: #ffffff;
            --hover-bg-color: rgba(55, 53, 47, 0.03);
            --active-bg-color: rgba(55, 53, 47, 0.05);
            --focus-border-color: #246a9e;
            --notion-blue: #0b6e9e;
            --notion-red: #d33c3f;
            --notion-green: #298d5c;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: var(--text-color);
            background-color: #f7f7f7;
            margin: 0;
            padding: 40px 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        header {
            margin-bottom: 40px;
        }

        h1 {
            font-size: 38px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        h1 span {
            margin-right: 12px;
            font-size: 32px;
        }

        header p {
            font-size: 17px;
            color: var(--subtle-text-color);
            margin: 0;
        }

        /* Notion Card Styles */
        .notion-block {
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            margin-bottom: 24px;
            padding: 24px;
        }

        .notion-block h2, .notion-block h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .notion-block h3 {
             font-size: 18px;
             font-weight: 500;
        }


        /* Balance Summary */
        .balance-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            text-align: center;
            padding-top: 12px;
            border-bottom: 2px solid var(--notion-blue);
            padding-bottom: 24px;
        }

        .balance-summary > div {
            padding: 12px;
            border-radius: 3px;
            background-color: var(--hover-bg-color);
        }

        .balance-summary p {
            margin: 0;
        }

        .balance-summary .label {
            font-size: 13px;
            font-weight: 500;
            color: var(--subtle-text-color);
            margin-bottom: 6px;
        }

        .balance-summary .value {
            font-size: 22px;
            font-weight: 700;
        }

        .balance-summary .main-balance {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-color);
        }

        .income-text { color: var(--notion-green); }
        .expense-text { color: var(--notion-red); }

        /* Form & Input Styles */
        .transaction-form {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .notion-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            font-size: 14px;
            color: var(--text-color);
            background-color: var(--background-color);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            box-sizing: border-box;
        }

        .notion-input:focus {
            outline: none;
            border-color: var(--notion-blue);
            box-shadow: 0 0 0 1px var(--notion-blue);
        }

        .transaction-form button {
            width: 100%;
            padding: 8px 10px;
            background-color: var(--notion-blue);
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out, opacity 0.1s ease-in-out;
            box-sizing: border-box;
        }

        .transaction-form button:hover {
            background-color: #085f8a;
        }

        .transaction-form button:disabled {
            background-color: #aeb8c4;
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* Local Storage Status */
        #user-status {
            text-align: center;
            padding: 10px;
            font-size: 14px;
            color: var(--subtle-text-color);
        }


        /* Transaction List */
        .transaction-list-controls {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .transaction-list-controls > div {
            display: flex;
            gap: 10px;
            margin-bottom: 10px; /* For mobile wrap */
        }
        
        #transfer-btn {
            background: var(--background-color);
            color: var(--notion-blue);
            border: 1px solid var(--border-color);
            padding: 8px 10px;
            border-radius: 3px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out;
            min-width: 130px;
        }
        #transfer-btn:hover {
            background-color: var(--hover-bg-color);
            border-color: var(--notion-blue);
        }

        .transaction-list-header {
            display: grid;
            grid-template-columns: 2fr 5fr 2fr 2fr 1fr;
            padding: 8px 10px;
            font-size: 13px;
            font-weight: 500;
            color: var(--subtle-text-color);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 4px;
        }

        .transaction-item {
            display: grid;
            grid-template-columns: 2fr 5fr 2fr 2fr 1fr;
            align-items: center;
            padding: 8px 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            transition: background-color 0.1s ease-in-out;
            cursor: pointer;
        }

        .transaction-item:hover {
            background-color: var(--hover-bg-color);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-item .date, .transaction-item .description, .transaction-item .type, .transaction-item .amount {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 8px;
        }

        .transaction-item .date { color: var(--subtle-text-color); }
        .transaction-item .description { font-weight: 500; }
        .transaction-item .type { text-align: center; }
        .transaction-item .amount { text-align: right; font-weight: 600; }

        .delete-btn {
            background: none;
            border: none;
            color: var(--subtle-text-color);
            cursor: pointer;
            padding: 4px;
            margin-left: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
        }

        .delete-btn:hover {
            background-color: var(--hover-bg-color);
            color: var(--notion-red);
        }

        .delete-btn svg {
            width: 16px;
            height: 16px;
            stroke-width: 2;
        }

        #no-transactions {
            text-align: center;
            padding: 40px 20px;
            color: var(--subtle-text-color);
            font-size: 15px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            display: none; 
            align-items: center;
            justify-content: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 24px;
            width: 90%;
            max-width: 600px;
            color: var(--text-color);
            max-height: 90vh;
            margin: 20px 0;
            box-sizing: border-box;
        }
        
        /* New Font Styles for Alert Modal */
        .alert-content {
            /* êµ´ë¦¼ì²´ */
            font-family: 'Gulim', 'Malgun Gothic', sans-serif; 
        }
        .alert-content h4 {
            /* ê¶ì„œì²´ */
            font-family: 'GungSeo', serif; 
            font-weight: normal;
        }

        .modal-content h4 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .modal-content p {
            font-size: 15px;
            margin-bottom: 15px;
            color: var(--subtle-text-color);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions button {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out;
        }

        .modal-actions .cancel-btn {
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .modal-actions .cancel-btn:hover {
            background-color: var(--hover-bg-color);
        }

        .modal-actions .confirm-btn {
            background-color: var(--notion-red);
            color: white;
            border-color: var(--notion-red);
        }
        .modal-actions .confirm-btn:hover {
            background-color: #b52a2d;
            border-color: #b52a2d;
        }
        
        /* Transfer Modal Specific Styles */
        
        .transfer-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .transfer-buttons button {
             padding: 8px 15px;
             background-color: var(--notion-blue);
             color: white;
             border: none;
             transition: background-color 0.1s ease-in-out;
             border-radius: 3px;
        }
        
        .transfer-buttons .import-btn {
            background-color: var(--notion-green);
        }
        .transfer-buttons .import-btn:hover {
            background-color: #217349;
        }
        
        .transfer-buttons button:hover {
            background-color: #085f8a;
        }
        
        .modal-status-message {
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
            text-align: center;
        }

        /* Responsive adjustments (CSS remains the same for responsiveness) */
        @media (max-width: 768px) {
            .container { padding: 0 16px; }
            h1 { font-size: 32px; }
            .notion-block { padding: 16px; }
            .balance-summary { grid-template-columns: 1fr; gap: 10px; padding-bottom: 16px; }
            .transaction-form { grid-template-columns: 1fr; gap: 8px; }
            .transaction-form button { margin-top: 8px; }
            .transaction-list-header { display: none; }
            .transaction-item { grid-template-columns: 1fr auto; padding: 10px 10px; }
            .transaction-item .date { grid-column: 1 / 2; font-size: 12px; margin-bottom: 4px; padding-right: 0; }
            .transaction-item .description { grid-column: 1 / 2; font-size: 14px; font-weight: 600; padding-right: 0; }
            .transaction-item .type { display: none; }
            .transaction-item .amount { grid-column: 2 / 3; grid-row: 1 / 3; display: flex; flex-direction: column; justify-content: center; align-items: flex-end; padding-right: 0; }
            .delete-btn { grid-column: 3 / 4; grid-row: 1 / 3; align-self: center; justify-self: center; padding: 0; }
            #transfer-btn { margin-right: auto; }
            .transaction-list-controls { flex-direction: column; align-items: stretch;}
            .transaction-list-controls > div { justify-content: space-between; gap: 5px; margin-bottom: 0; }
        }
    </style>
</head>
<body>
    
    <div class="container">
        
        <header>
            <h1>
                <span>ğŸ““</span> ìš©ëˆ ê¸°ì…ì¥
            </h1>
            <p>ê¸°ë¡ì€ ê¸°ì–µì„ ì§€ë°°í•©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì¬ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
        </header>

        
        <div class="notion-block">
            <h2>ì¬ì • ìš”ì•½</h2>
            <div class="balance-summary">
                <div>
                    <p class="label">ì´ ìˆ˜ì…</p>
                    <p id="total-income" class="value income-text">
                        +0ì›
                    </p>
                </div>
                <div>
                    <p class="label">ì´ ì§€ì¶œ</p>
                    <p id="total-expense" class="value expense-text">
                        -0ì›
                    </p>
                </div>
                <div>
                    <p class="label">ìˆœ ì”ì•¡</p>
                    <p id="current-balance" class="value main-balance">
                        0ì›
                    </p>
                </div>
            </div>
        </div>

        
        <section class="notion-block">
            <h3>ìƒˆë¡œìš´ ê¸°ë¡ ì¶”ê°€</h3>
            <form id="transaction-form" class="transaction-form">
                <div style="grid-column: span 1;">
                    <input type="date" id="date" required title="ë‚ ì§œ" class="notion-input">
                </div>
                <div style="grid-column: span 2;">
                    <input type="text" id="description" placeholder="ë‚´ìš© (ì˜ˆ: ì ì‹¬ ì‹ì‚¬, ìš©ëˆ)" required class="notion-input">
                </div>
                <div style="grid-column: span 1;">
                    <select type="type" id="type" required title="ìœ í˜•" class="notion-input">
                        <option value="expense">ì§€ì¶œ</option>
                        <option value="income">ìˆ˜ì…</option>
                    </select>
                </div>
                <div style="grid-column: span 1;">
                    <input type="number" id="amount" placeholder="ê¸ˆì•¡" required min="1" class="notion-input">
                </div>
                <div style="grid-column: span 1;">
                    <button type="submit" id="add-btn">
                        ì¶”ê°€
                    </button>
                </div>
            </form>
            <div id="user-status">
                (ë°ì´í„°ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥ë©ë‹ˆë‹¤.)
            </div>
        </section>

        
        <section class="notion-block">
            <div class="transaction-list-controls">
                <h3>ì „ì²´ ê±°ë˜ ë‚´ì—­</h3>
                <div>
                    <button id="transfer-btn" title="ë‹¤ë¥¸ ê¸°ê¸°ë¡œ ë°ì´í„°ë¥¼ ì˜®ê¸°ê±°ë‚˜ ë°±ì—…í•©ë‹ˆë‹¤.">
                        ë°ì´í„° ì´ì „/ë°±ì—…
                    </button>
                    <select id="sort-order" class="notion-input" style="width: 150px;">
                        <option value="desc">ìµœì‹ ìˆœ (ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ)</option>
                        <option value="asc">ì˜¤ë˜ëœìˆœ (ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ)</option>
                    </select>
                </div>
            </div>
            
            <div class="transaction-list-header">
                <div>ë‚ ì§œ</div>
                <div>ë‚´ìš©</div>
                <div style="text-align: center;">ìœ í˜•</div>
                <div style="text-align: right;">ê¸ˆì•¡</div>
                <div></div> 
            </div>

            <div id="transaction-list">
                <!-- ê±°ë˜ í•­ëª©ì´ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤. -->
            </div>

            <p id="no-transactions" class="hidden">
                ì•„ì§ ê¸°ë¡ëœ ê±°ë˜ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ê¸°ë¡ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
            </p>
        </section>
    </div>

    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="delete-modal" class="modal-overlay">
        <div class="modal-content">
            <h4>ğŸ—‘ï¸ ê¸°ë¡ ì‚­ì œ í™•ì¸</h4>
            <p>ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <div class="modal-actions">
                <button id="cancel-delete-btn" class="cancel-btn">
                    ì·¨ì†Œ
                </button>
                <button id="confirm-delete-btn" class="confirm-btn">
                    ì‚­ì œ
                </button>
            </div>
        </div>
    </div>
    
    <!-- ë°ì´í„° ì´ì „/ë³µì› ëª¨ë‹¬ -->
    <div id="transfer-modal" class="modal-overlay">
        <div class="modal-content">
            <h4>ğŸ”„ ë°ì´í„° ì´ì „/ë°±ì—…</h4>
            <p>íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° ì—…ë¡œë“œë¥¼ í†µí•´ ë‹¤ë¥¸ ê¸°ê¸°ë¡œ ë°ì´í„°ë¥¼ ì˜®ê¸°ê±°ë‚˜ ë°±ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            
            <div style="border: 1px solid var(--border-color); border-radius: 3px; padding: 15px;">
                
                <!-- 1. ë‹¤ìš´ë¡œë“œ (Export) UI -->
                <p style="font-size: 14px; margin-bottom: 8px; color: var(--text-color); font-weight: 600;">1. ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)</p>
                <p style="font-size: 13px; color: var(--subtle-text-color); margin-bottom: 15px;">
                    í˜„ì¬ ê¸°ë¡ì„ '.ìš©ëˆ' í™•ì¥ì íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë°±ì—…í•©ë‹ˆë‹¤.
                </p>
                
                <button id="download-data-btn" class="notion-input" style="width: auto; background-color: var(--notion-blue); color: white;">
                    ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ (.ìš©ëˆ)
                </button>

                <!-- 2. ì—…ë¡œë“œ (Import) UI -->
                <p style="font-size: 14px; margin-bottom: 8px; color: var(--notion-red); font-weight: 600; margin-top: 30px;">2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µì›)</p>
                <p style="font-size: 13px; color: var(--notion-red); margin-bottom: 15px;">
                    ì£¼ì˜: ë³µì› ì‹œ **í˜„ì¬ ë¸Œë¼ìš°ì €ì˜ ëª¨ë“  ê¸°ë¡ì€ ì‚­ì œ**ë˜ê³  ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ë°ì´í„°ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.
                </p>
                
                <!-- Hidden file input -->
                <input type="file" id="file-input" accept=".ìš©ëˆ, .json" style="display: none;">

                <div class="transfer-buttons">
                    <button id="upload-file-btn" class="notion-input import-btn">
                        .ìš©ëˆ íŒŒì¼ ì—…ë¡œë“œ ë° ë³µì›
                    </button>
                    <!-- ë‹«ê¸° ë²„íŠ¼ ìˆ˜ì •ë¨ -->
                    <button id="close-transfer-modal-btn" class="notion-input cancel-btn" style="background-color: var(--background-color); color: var(--text-color); border-color: var(--border-color);">
                        ë‹«ê¸°
                    </button>
                </div>
                <div id="transfer-status" class="modal-status-message"></div>
            </div>
        </div>
    </div>
    
    <!-- ì•Œë¦¼ íŒì—… (ë°ì´í„° ì†ì‹¤ ê²½ê³ ) - ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ í‘œì‹œ -->
    <div id="alert-modal" class="modal-overlay visible">
        <div class="modal-content alert-content">
            <h4 style="text-align: center;">ì•Œ ë¦¼</h4>
            <p style="font-size: 15px; margin-bottom: 25px; line-height: 1.6; color: var(--notion-red); text-align: center;">
                í˜„ì¬ ì—…ë°ì´íŠ¸ë¡œ ì¸í•´ ë°ì´íƒ€ê°€ ì†ì‹¤ë˜ì—ˆìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸ê°€ ìˆì„ì‹œ ë°ì´íƒ€ëŠ” ì†ì‹¤ë˜ë¯€ë¡œ ë§¤ì¼ ë°±ì—…í•´ë†“ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
            </p>
            <p style="font-size: 14px; text-align: center; color: var(--text-color); margin-bottom: 0;">
                [ë°±ì—…ì€ í•˜ë‹¨ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤]
            </p>
            <div class="modal-actions" style="justify-content: center;">
                <button id="close-alert-btn" class="cancel-btn" style="border-color: var(--notion-blue); color: var(--notion-blue);">
                    í™•ì¸
                </button>
            </div>
        </div>
    </div>


    <script>
        // ë¡œì»¬ ì €ì¥ì†Œ í‚¤
        const LOCAL_STORAGE_KEY = 'notion_style_money_book_transactions_local';

        // DOM ìš”ì†Œ
        const transactionForm = document.getElementById('transaction-form');
        const transactionListContainer = document.getElementById('transaction-list');
        const currentBalanceEl = document.getElementById('current-balance');
        const totalIncomeEl = document.getElementById('total-income');
        const totalExpenseEl = document.getElementById('total-expense');
        const noTransactionsEl = document.getElementById('no-transactions');
        const addBtn = document.getElementById('add-btn');
        const sortOrderSelect = document.getElementById('sort-order');
        const transferBtn = document.getElementById('transfer-btn');

        // ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ
        const deleteModal = document.getElementById('delete-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

        const transferModal = document.getElementById('transfer-modal');
        const transferStatus = document.getElementById('transfer-status');
        const closeTransferModalBtn = document.getElementById('close-transfer-modal-btn'); // ID ë³€ê²½ë¨

        // íŒŒì¼ ì´ì „ ê´€ë ¨ ìš”ì†Œ
        const downloadDataBtn = document.getElementById('download-data-btn'); 
        const uploadFileBtn = document.getElementById('upload-file-btn');     
        const fileInput = document.getElementById('file-input');             
        
        // ì•Œë¦¼ íŒì—… ê´€ë ¨ ìš”ì†Œ (NEW)
        const alertModal = document.getElementById('alert-modal');
        const closeAlertBtn = document.getElementById('close-alert-btn');

        let transactionToDeleteId = null;

        // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ê¸°ë³¸ ì„¤ì •
        document.getElementById('date').value = new Date().toISOString().substring(0, 10);

        // =========================================================
        // 1. Local Storage Handlers
        // =========================================================

        /**
         * ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ê±°ë˜ ë‚´ì—­ ë¶ˆëŸ¬ì˜¤ê¸°
         */
        function loadTransactions() {
            try {
                const json = localStorage.getItem(LOCAL_STORAGE_KEY);
                // Ensure unique IDs are generated if not present (for compatibility)
                const transactions = json ? JSON.parse(json) : [];
                return transactions.map(tx => {
                    if (!tx.id) tx.id = Date.now().toString() + Math.random().toString().slice(2, 6);
                    return tx;
                });
            } catch (e) {
                console.error("ë¡œì»¬ ì €ì¥ì†Œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
                return [];
            }
        }

        /**
         * ë¡œì»¬ ì €ì¥ì†Œì— ê±°ë˜ ë‚´ì—­ ì €ì¥í•˜ê¸°
         */
        function saveTransactions(transactions) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(transactions));
            } catch (e) {
                console.error("ë¡œì»¬ ì €ì¥ì†Œ ì €ì¥ ì˜¤ë¥˜:", e);
            }
        }

        // =========================================================
        // 2. UI Rendering and Sorting
        // =========================================================
        
        // ì •ë ¬ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ UI ë Œë”ë§
        sortOrderSelect.addEventListener('change', renderUI);


        /**
         * UI ì—…ë°ì´íŠ¸ ë° ì”ì•¡ ê³„ì‚° (ë¡œì»¬ ìºì‹œ ë°ì´í„° ì‚¬ìš©)
         */
        function renderUI() {
            let transactions = loadTransactions();
            const sortOrder = sortOrderSelect.value;
            let sortedTransactions = [...transactions];

            // 1. In-memory Sorting (ë‚ ì§œ ë° ID ê¸°ì¤€)
            sortedTransactions.sort((a, b) => {
                const dateA = a.date;
                const dateB = b.date;

                // ë‚ ì§œ ë¹„êµ
                if (dateA < dateB) return sortOrder === 'asc' ? -1 : 1;
                if (dateA > dateB) return sortOrder === 'asc' ? 1 : -1;

                // ë‚ ì§œê°€ ê°™ìœ¼ë©´ ID (ìƒì„± ì‹œì )ë¡œ ë¹„êµ (ìµœì‹  ì¶”ê°€ëœ í•­ëª©ì´ ë” ë’¤ë¡œ ê°€ê²Œ)
                // ë¡œì»¬ ì €ì¥ì†Œ ê¸°ë°˜ ì•±ì´ë¯€ë¡œ, ID(timestamp + random)ê°€ ìµœì¢… ìƒì„± ìˆœì„œë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
                if (sortOrder === 'desc') {
                    return b.id.localeCompare(a.id);
                } else {
                    return a.id.localeCompare(b.id);
                }
            });

            transactionListContainer.innerHTML = '';
            let totalIncome = 0;
            let totalExpense = 0;

            if (sortedTransactions.length === 0) {
                noTransactionsEl.classList.remove('hidden');
            } else {
                noTransactionsEl.classList.add('hidden');
            }

            // 2. Calculate totals and render items
            sortedTransactions.forEach(tx => {
                // Ensure amount is a number before calculation
                const amount = parseFloat(tx.amount);
                if (tx.type === 'income') {
                    totalIncome += amount;
                } else {
                    totalExpense += amount;
                }
                const item = createTransactionItem(tx);
                transactionListContainer.appendChild(item);
            });
            
            const currentBalance = totalIncome - totalExpense;

            // 3. Update Summary
            totalIncomeEl.textContent = '+' + formatCurrency(totalIncome);
            totalExpenseEl.textContent = '-' + formatCurrency(totalExpense);
            
            currentBalanceEl.textContent = formatCurrency(currentBalance);
            currentBalanceEl.classList.remove('income-text', 'expense-text');
            if (currentBalance < 0) {
                currentBalanceEl.classList.add('expense-text');
            } else if (currentBalance > 0) {
                 currentBalanceEl.classList.add('income-text');
            }
        }
        
        // =========================================================
        // 3. UI Helpers
        // =========================================================

        /**
         * í™”í ë‹¨ìœ„ í¬ë§· (í•œêµ­ ì›)
         */
        function formatCurrency(number) {
            const cleanNumber = Math.floor(number);
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW'
            }).format(cleanNumber);
        }

        /**
         * ê±°ë˜ ë‚´ì—­ ëª©ë¡ í•­ëª© (Div) ìƒì„± (Notion ìŠ¤íƒ€ì¼)
         */
        function createTransactionItem(tx) {
            const isExpense = tx.type === 'expense';
            const amountClass = isExpense ? 'expense-text' : 'income-text';
            const typeText = isExpense ? 'ì§€ì¶œ' : 'ìˆ˜ì…';
            const typeEmoji = isExpense ? 'ğŸ”»' : 'ğŸ”º';
            const amountValue = parseFloat(tx.amount);

            // í•œêµ­ ë‚ ì§œ í¬ë§· (YYYY.MM.DD)
            const formattedDate = tx.date.replace(/-/g, '.');

            const item = document.createElement('div');
            item.className = 'transaction-item';
            item.innerHTML = `
                <div class="date">${formattedDate}</div>
                <div class="description">${tx.description}</div>
                <div class="type">${typeEmoji} ${typeText}</div>
                <div class="amount ${amountClass}">
                    ${(isExpense ? '-' : '+') + formatCurrency(amountValue)}
                </div>
                <button data-id="${tx.id}" class="delete-btn" title="ì‚­ì œ">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
            `;
            return item;
        }

        // =========================================================
        // 4. CRUD Operations
        // =========================================================

        /**
         * ê±°ë˜ ì¶”ê°€ í•¸ë“¤ëŸ¬
         */
        transactionForm.addEventListener('submit', (e) => {
            e.preventDefault();

            addBtn.disabled = true;
            addBtn.textContent = 'ì¶”ê°€ ì¤‘...';

            const date = document.getElementById('date').value;
            const description = document.getElementById('description').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            // ê³ ìœ  ID ìƒì„± (ë¡œì»¬ ì €ì¥ì†Œìš©)
            const id = Date.now().toString() + Math.random().toString().slice(2, 6); 

            if (isNaN(amount) || amount <= 0 || !description) {
                console.error("ê¸ˆì•¡ì€ ì–‘ìˆ˜ì—¬ì•¼ í•˜ë©° ë‚´ìš©ì€ ë¹„ì›Œë‘˜ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                addBtn.disabled = false;
                addBtn.textContent = 'ì¶”ê°€';
                return;
            }

            try {
                const transactions = loadTransactions();
                // ê¸ˆì•¡ì„ ìˆ«ìë¡œ ì €ì¥í•˜ë„ë¡ ëª…í™•íˆ
                transactions.push({ id, date, description, amount: amount, type }); 
                saveTransactions(transactions);

                transactionForm.reset();
                document.getElementById('date').value = new Date().toISOString().substring(0, 10);
                renderUI(); // UI ê°±ì‹ 
                
            } catch (error) {
                console.error("ê±°ë˜ ì¶”ê°€ ì˜¤ë¥˜: ", error);
            } finally {
                addBtn.disabled = false;
                addBtn.textContent = 'ì¶”ê°€';
            }
        });

        // ----------------------
        // Delete Modal Handlers
        // ----------------------

        /**
         * ê±°ë˜ ì‚­ì œ í•¸ë“¤ëŸ¬ (ì´ë²¤íŠ¸ ìœ„ì„)
         */
        transactionListContainer.addEventListener('click', (e) => {
            const deleteButton = e.target.closest('.delete-btn');
            if (deleteButton) {
                transactionToDeleteId = deleteButton.dataset.id;
                deleteModal.classList.add('visible');
            }
        });

        /**
         * ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ì œì–´: ì·¨ì†Œ
         */
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.remove('visible');
            transactionToDeleteId = null;
        });

        /**
         * ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ì œì–´: í™•ì¸
         */
        confirmDeleteBtn.addEventListener('click', () => {
            if (!transactionToDeleteId) return;

            deleteModal.classList.remove('visible');

            try {
                let transactions = loadTransactions();
                // í•´ë‹¹ IDë¥¼ ê°€ì§„ ê±°ë˜ ì œê±°
                transactions = transactions.filter(tx => tx.id !== transactionToDeleteId);
                saveTransactions(transactions);
                renderUI(); // UI ê°±ì‹ 
                
                console.log("ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ê±°ë˜ ì‚­ì œ ì™„ë£Œ ID:", transactionToDeleteId);
            } catch (error) {
                console.error("ê±°ë˜ ì‚­ì œ ì˜¤ë¥˜: ", error);
            } finally {
                transactionToDeleteId = null;
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.classList.remove('visible');
                transactionToDeleteId = null;
            }
        });

        // =========================================================
        // 5. Data Transfer (File Download/Upload)
        // =========================================================

        /**
         * ë°ì´í„°ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³  .ìš©ëˆ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ (Export)
         */
        function downloadData() {
            const transactions = loadTransactions();
            const jsonString = JSON.stringify(transactions, null, 2);
            
            // 1. Blob ìƒì„±
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // 2. ì„ì‹œ <a> íƒœê·¸ë¥¼ ì´ìš©í•´ ë‹¤ìš´ë¡œë“œ íŠ¸ë¦¬ê±°
            const a = document.createElement('a');
            a.href = url;
            // íŒŒì¼ëª…: ìš©ëˆ_ê¸°ì…ì¥_ë°±ì—…_YYYY-MM-DD.ìš©ëˆ
            a.download = `ìš©ëˆ_ê¸°ì…ì¥_ë°±ì—…_${new Date().toISOString().substring(0, 10)}.ìš©ëˆ`;
            
            // 3. ë‹¤ìš´ë¡œë“œ ì‹¤í–‰ ë° ì •ë¦¬
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            transferStatus.textContent = 'âœ… ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
            transferStatus.style.color = 'var(--notion-green)';
        }
        
        // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        downloadDataBtn.addEventListener('click', downloadData);


        /**
         * íŒŒì¼ ì—…ë¡œë“œ ë° ë°ì´í„° ë³µì› (Import)
         */
        uploadFileBtn.addEventListener('click', () => {
            // ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ í•„ë“œë¥¼ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ ëŒ€í™” ìƒìë¥¼ ì—½ë‹ˆë‹¤.
            fileInput.click();
            transferStatus.textContent = ''; // ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) {
                transferStatus.textContent = 'âŒ íŒŒì¼ì„ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                transferStatus.style.color = 'var(--notion-red)';
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const jsonString = event.target.result;
                try {
                    const importedData = JSON.parse(jsonString);

                    // ê°„ë‹¨í•œ ìœ íš¨ì„± ê²€ì‚¬: ë°°ì—´ì´ë©°, ì²« í•­ëª©ì— í•„ìˆ˜ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
                    if (!Array.isArray(importedData) || (importedData.length > 0 && 
                        (!importedData[0].id || !importedData[0].date || typeof importedData[0].amount !== 'number'))) {
                        
                        throw new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ JSON ë°°ì—´ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    }

                    // ë°ì´í„° ë³µì› ë° ë®ì–´ì“°ê¸°
                    saveTransactions(importedData);
                    renderUI();
                    transferStatus.textContent = `âœ¨ ${file.name} íŒŒì¼ë¡œ ë°ì´í„° ë³µì› ë° ë®ì–´ì“°ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`;
                    transferStatus.style.color = 'var(--notion-green)';
                    
                    // ì„±ê³µ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
                    setTimeout(() => {
                        transferModal.classList.remove('visible');
                    }, 1500);
                    
                } catch (error) {
                    console.error("ë°ì´í„° ë³µì› ì˜¤ë¥˜:", error);
                    transferStatus.textContent = 'âŒ íŒŒì¼ ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.message || 'íŒŒì¼ ë‚´ìš©ì´ ì˜¬ë°”ë¥¸ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    transferStatus.style.color = 'var(--notion-red)';
                }
            };
            
            reader.onerror = () => {
                 transferStatus.textContent = 'âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                 transferStatus.style.color = 'var(--notion-red)';
            };

            reader.readAsText(file);
            e.target.value = ''; // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ì„ ë‹¤ì‹œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡)
        });


        // ----------------------
        // Transfer Modal Handlers (ìˆ˜ì •ë¨)
        // ----------------------

        /**
         * ë°ì´í„° ì´ì „ ëª¨ë‹¬ ì—´ê¸°
         */
        transferBtn.addEventListener('click', () => {
            transferStatus.textContent = ''; // ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
            transferModal.classList.add('visible');
        });

        /**
         * ë°ì´í„° ì´ì „ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ (ë‹«ê¸°)
         */
        closeTransferModalBtn.addEventListener('click', () => {
            transferModal.classList.remove('visible');
        });
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        transferModal.addEventListener('click', (e) => {
            if (e.target === transferModal) {
                transferModal.classList.remove('visible');
            }
        });
        
        // =========================================================
        // 6. Initial Alert Modal (NEW)
        // =========================================================
        
        closeAlertBtn.addEventListener('click', () => {
            alertModal.classList.remove('visible');
        });

        alertModal.addEventListener('click', (e) => {
            if (e.target === alertModal) {
                alertModal.classList.remove('visible');
            }
        });


        // ì•± ì‹œì‘ ì‹œ ë°ì´í„° ë¡œë“œ ë° UI ì—…ë°ì´íŠ¸ (Alert Modalì€ CSSì—ì„œ visible ìƒíƒœë¡œ ì‹œì‘)
        // renderUI(); 
        // Initial renderUI is intentionally skipped until the alert is dismissed if needed, but for simplicity and robustness, we keep it here.
        renderUI();
    </script>
</body>
</html>
